#!/usr/bin/env node
const { spawn } = require('child_process');
const path = require('path');
const fs = require('fs');
const os = require('os');

const basePath = '../publish/bin';
const arch = os.arch();
const platform = os.platform();

let binaryPath;

let partialTarget = `RootApp.AppSdk.Lite.Console`;

if (platform === 'win32') {
  binaryPath = path.join(__dirname, basePath, partialTarget+'.exe');
} else {
  binaryPath = path.join(__dirname, basePath, partialTarget);
}

if (!fs.existsSync(binaryPath)) {
  console.error(`CLI binary not found for ${platform}-${arch}`);
  process.exit(1);
}

if (platform != "win32") {
	fs.chmodSync(binaryPath, 0o755);
}

let args = process.argv.slice(2);

args.unshift('package')
console.log(`${binaryPath} ${args.join(' ')}`);

const child = spawn(binaryPath, args, { stdio: 'inherit' });

child.on('exit', (code) => {
  process.exit(code);
});

